$(function(){const e=1e3,o={first:0,second:0},s=$("#backdrop"),t=$("#center .message"),l=$("#movements"),i=l.find(".message");let r=[{colors:["Yellow"],rollsBeforeFirstSix:0},{colors:[],rollsBeforeFirstSix:0},{colors:[],rollsBeforeFirstSix:0},{colors:[],rollsBeforeFirstSix:0}],a=-1,c=null,n=[];const d=$("#die-1").dice({duration:e,imageUrl:"./assets/img/dice.png",value:6}),f=$("#die-2").dice({duration:e,imageUrl:"./assets/img/dice.png",value:6}),h=()=>{$(".roll-dice").removeClass("hide"),$(".roll").addClass("hide"),s.addClass("hide"),a++,a===n.length&&(a=0);const e=r[a];e.colors.forEach(e=>{e=e.toLowerCase(),$(`.home.${e} .roll`).removeClass("hide")})},p=()=>{if(!o.first||!o.second)return;const e=r[a];let c=0;if(e.colors.forEach(e=>{e=e.toLowerCase(),6!==o.first&&6!==o.second||$(`.home.${e} .piece-cover`).addClass("hide"),$(`.piece.${e}`).addClass("active").siblings(".piece-cover").addClass("hide"),c+=$(`.step .piece.${e}`).length}),!c&&6!==o.first&&6!==o.second)return s.removeClass("hide"),l.children(".move").addClass("hide"),i.removeClass("hide").children("span").text("You need a 6 to get your piece into the action.");$("#movements > .first > div").text(o.first),$("#movements > .second > div").text(o.second),t.text(`Select a ${e.colors.join(" or ")} piece to move.`).removeClass("hide")},m=e=>{if(!e)return;const o=c.closest("td").attr("class").split(" ");let s=parseInt(o[o.length-1]);$(`td.${++s}`).prepend(c.remove()),setTimeout(m,300,--e)};if($("a").click(function(e){e.preventDefault();const l=$(this);if(l.hasClass("piece"))c=l,s.removeClass("hide").children("#movements").removeClass("hide");else if(l.hasClass("move")){let e=0;l.hasClass("first")?(e=o.first,o.first=0):(e=o.second,o.second=0),t.text(`Moving ${e} steps`),m(e)}}),$("#options select").change(function(){const e=$(this),o=e.data("playerIndex"),s=e.data("colorIndex"),t=e.val(),l=r[o];if(e.addClass("active"),l.colors[s]){const o=l.colors[s];e.closest("#options").find(`option.${o.toLowerCase()}`).removeClass("hide")}if(t)e.closest("#options").find("select:not(.active)").find(`option.${t.toLowerCase()}`).addClass("hide"),e.parent().find("select:not(.active)").prop("disabled",!1),l.colors.length&&l.colors.splice(s,1),l.colors.push(t);else if(s)l.colors.splice(s,1);else{if(l.colors[1]){const o=l.colors[1];e.closest("#options").find(`option.${o.toLowerCase()}`).removeClass("hide")}l.colors=[],e.parent().find("select:not(.active)").prop("disabled",!0).val("")}e.removeClass("active")}),$("#play").click(function(){n=r.filter(e=>!!e.colors.length),window.localStorage&&localStorage.setItem("players",JSON.stringify(r)),s.addClass("hide").find("#options").addClass("hide").siblings("#movements").removeClass("hide"),h()}),$(".roll").click(function(){n.length&&($(".roll").addClass("hide"),o.first=0,o.second=0,d.dice("roll",e=>{o.first=e,p()}),f.dice("roll",e=>{o.second=e,p()}))}),$("#movements button").click(function(){h()}),window.localStorage){let e=localStorage.getItem("players");e&&(e=JSON.parse(e),e.forEach(({colors:e},o)=>{e.forEach((e,s)=>{const t=`select[data-player-index="${o}"][data-color-index="${s}"]`;$(t).val(e).trigger("change")})}))}window.onbeforeunload=function(e){n.length&&(prompt("The current game would be lost!")||(e.preventDefault(),e.returnValue=""))}});